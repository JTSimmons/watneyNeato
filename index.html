<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Watney-1 Rover</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="js/lib/adapter.js"></script>
    <script src="js/common.js"></script>
    <script src="js/main_rws.js"></script>
    <script>
        var up = false;
        var down = false;
        var left = false;
        var right = false;
        
        var lastBearing = -1;
        
        function sendKeys() {
            var bearing = -1;
            
            if (up) {
                if (left) {
                    bearing = 135;
                }
                else if (right) {
                    bearing = 45;
                }
                else {
                    bearing = 90;
                }
            }
            else if (down) {
                if (left) {
                    bearing = 225;
                }
                else if (right) {
                    bearing = 315;
                }
                else {
                    bearing = 270;
                }
            }
            else if (left) {
                bearing = 180;
            }
            else if (right) {
                bearing = 0;
            }
            
            if (lastBearing != bearing) {
                lastBearing = bearing;
                var bearingObj = {
                    'bearing': bearing
                };
            
                $.ajax({
                      url:'/sendBearing',
                      type:"POST",
                      data:JSON.stringify(bearingObj),
                      contentType:"application/json; charset=utf-8",
                      dataType:"json"
                });
            }
            
            
        }
        
        $(document).ready(function() {
            $("#inputControl").keydown(function(event) {
                event.preventDefault();

                if (event.keyCode == 38) {
                    up = true;
                }
                else if (event.keyCode == 40) {
                    down = true;
                }
                else if(event.keyCode == 37) {
                    left = true;
                }
                else if(event.keyCode == 39) {
                    right = true;
                }
                
                sendKeys();
            });

            $("#inputControl").keyup(function(event) {
                event.preventDefault();
                
                if (event.keyCode == 38) {
                    up = false;
                }
                else if (event.keyCode == 40) {
                    down = false;
                }
                else if(event.keyCode == 37) {
                    left = false;
                }
                else if(event.keyCode == 39) {
                    right = false;
                }
                
                sendKeys();
            });

            $("#inputControl").focus(function(event) {
                 $(this).attr("placeholder", "Use Arrow Keys");
            });

            $("#inputControl").focusout(function(event) {
                 $(this).attr("placeholder", "Click Here");
            });

            doConnect();

        });

</script>
    <style>
    #vid {
        position: relative;
        width: auto;
        height: 100%;
        background-size: cover;
        overflow: hidden;
        left: 50%;
        transform: translateX(-50%)
    }
    #videoPlaceholder {
        width: 100%;
        height: 100%;
        background-color: black;
    }

    input::placeholder {
        text-align: center;
        vertical-align: middle;
        font-size: 3em
    }
}
    </style>
</head>

<body>
<table style="position: absolute; top: 0; bottom: 0; left: 0; right: 0; height: 100%; width: 100%">
    <tr style="height:100%;">
        <td style="padding:0;">
            <div id="videoPlaceholder">
                <video id="vid" autoplay ></video>
            </div>
        </td>
    </tr>
    <tr style="height: 200px;">
        <td style="padding: 10px;">
            <input id="inputControl" type="text" style="width:100%; height: 100%; color: transparent;" placeholder="Click Here" />
        </td>
    </tr>
</table>
</body>
</html>